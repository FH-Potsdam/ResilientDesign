// Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
// 
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
// 
// http://www.apache.org/licenses/LICENSE-2.0
// 
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
Snap.plugin(function(e,t,n,r,i){function f(e,t,n,r,i,o){if(t==null&&s.call(e)=="[object SVGMatrix]"){this.a=e.a;this.b=e.b;this.c=e.c;this.d=e.d;this.e=e.e;this.f=e.f;return}if(e!=null){this.a=+e;this.b=+t;this.c=+n;this.d=+r;this.e=+i;this.f=+o}else{this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0}}var s=Object.prototype.toString,o=String,u=Math,a="";(function(t){function n(e){return e[0]*e[0]+e[1]*e[1]}function r(e){var t=u.sqrt(n(e));e[0]&&(e[0]/=t);e[1]&&(e[1]/=t)}t.add=function(e,t,n,r,i,s){var o=[[],[],[]],u=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],a=[[e,n,i],[t,r,s],[0,0,1]],l,c,h,p;e&&e instanceof f&&(a=[[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]]);for(l=0;l<3;l++)for(c=0;c<3;c++){p=0;for(h=0;h<3;h++)p+=u[l][h]*a[h][c];o[l][c]=p}this.a=o[0][0];this.b=o[1][0];this.c=o[0][1];this.d=o[1][1];this.e=o[0][2];this.f=o[1][2];return this};t.invert=function(){var e=this,t=e.a*e.d-e.b*e.c;return new f(e.d/t,-e.b/t,-e.c/t,e.a/t,(e.c*e.f-e.d*e.e)/t,(e.b*e.e-e.a*e.f)/t)};t.clone=function(){return new f(this.a,this.b,this.c,this.d,this.e,this.f)};t.translate=function(e,t){return this.add(1,0,0,1,e,t)};t.scale=function(e,t,n,r){t==null&&(t=e);(n||r)&&this.add(1,0,0,1,n,r);this.add(e,0,0,t,0,0);(n||r)&&this.add(1,0,0,1,-n,-r);return this};t.rotate=function(t,n,r){t=e.rad(t);n=n||0;r=r||0;var i=+u.cos(t).toFixed(9),s=+u.sin(t).toFixed(9);this.add(i,s,-s,i,n,r);return this.add(1,0,0,1,-n,-r)};t.x=function(e,t){return e*this.a+t*this.c+this.e};t.y=function(e,t){return e*this.b+t*this.d+this.f};t.get=function(e){return+this[o.fromCharCode(97+e)].toFixed(4)};t.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"};t.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};t.determinant=function(){return this.a*this.d-this.b*this.c};t.split=function(){var t={};t.dx=this.e;t.dy=this.f;var i=[[this.a,this.c],[this.b,this.d]];t.scalex=u.sqrt(n(i[0]));r(i[0]);t.shear=i[0][0]*i[1][0]+i[0][1]*i[1][1];i[1]=[i[1][0]-i[0][0]*t.shear,i[1][1]-i[0][1]*t.shear];t.scaley=u.sqrt(n(i[1]));r(i[1]);t.shear/=t.scaley;this.determinant()<0&&(t.scalex=-t.scalex);var s=-i[0][1],o=i[1][1];if(o<0){t.rotate=e.deg(u.acos(o));s<0&&(t.rotate=360-t.rotate)}else t.rotate=e.deg(u.asin(s));t.isSimple=!+t.shear.toFixed(9)&&(t.scalex.toFixed(9)==t.scaley.toFixed(9)||!t.rotate);t.isSuperSimple=!+t.shear.toFixed(9)&&t.scalex.toFixed(9)==t.scaley.toFixed(9)&&!t.rotate;t.noRotation=!+t.shear.toFixed(9)&&!t.rotate;return t};t.toTransformString=function(e){var t=e||this.split();if(!+t.shear.toFixed(9)){t.scalex=+t.scalex.toFixed(4);t.scaley=+t.scaley.toFixed(4);t.rotate=+t.rotate.toFixed(4);return(t.dx||t.dy?"t"+[+t.dx.toFixed(4),+t.dy.toFixed(4)]:a)+(t.scalex!=1||t.scaley!=1?"s"+[t.scalex,t.scaley,0,0]:a)+(t.rotate?"r"+[+t.rotate.toFixed(4),0,0]:a)}return"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}})(f.prototype);e.Matrix=f;e.matrix=function(e,t,n,r,i,s){return new f(e,t,n,r,i,s)}});