// Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
// 
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
// 
// http://www.apache.org/licenses/LICENSE-2.0
// 
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
Snap.plugin(function(e,t,n,r,i){function m(n){return function(r){eve.stop();if(r instanceof i&&r.node.childNodes.length==1&&(r.node.firstChild.tagName=="radialGradient"||r.node.firstChild.tagName=="linearGradient"||r.node.firstChild.tagName=="pattern")){r=r.node.firstChild;f(this).appendChild(r);r=u(r)}if(r instanceof t)if(r.type=="radialGradient"||r.type=="linearGradient"||r.type=="pattern"){r.node.id||c(r.node,{id:r.id});var s=h(r.node.id)}else s=r.attr(n);else{s=e.color(r);if(s.error){var o=e(f(this).ownerSVGElement).gradient(r);if(o){o.node.id||c(o.node,{id:o.id});s=h(o.node.id)}else s=r}else s=p(s)}var a={};a[n]=s;c(this.node,a);this.node.style[n]=v}}function y(e){eve.stop();e==+e&&(e+="px");this.node.style.fontSize=e}function b(e){var t=[],n=e.childNodes;for(var r=0,i=n.length;r<i;r++){var s=n[r];s.nodeType==3&&t.push(s.nodeValue);s.tagName=="tspan"&&(s.childNodes.length==1&&s.firstChild.nodeType==3?t.push(s.firstChild.nodeValue):t.push(b(s)))}return t}function w(){eve.stop();return this.node.style.fontSize}var s="hasOwnProperty",o=e._.make,u=e._.wrap,a=e.is,f=e._.getSomeDefs,l=/^url\(#?([^)]+)\)$/,c=e._.$,h=e.url,p=String,d=e._.separator,v="";eve.on("snap.util.attr.mask",function(e){if(e instanceof t||e instanceof i){eve.stop();if(e instanceof i&&e.node.childNodes.length==1){e=e.node.firstChild;f(this).appendChild(e);e=u(e)}if(e.type=="mask")var n=e;else{n=o("mask",f(this));n.node.appendChild(e.node)}!n.node.id&&c(n.node,{id:n.id});c(this.node,{mask:h(n.id)})}});(function(e){eve.on("snap.util.attr.clip",e);eve.on("snap.util.attr.clip-path",e);eve.on("snap.util.attr.clipPath",e)})(function(e){if(e instanceof t||e instanceof i){eve.stop();if(e.type=="clipPath")var n=e;else{n=o("clipPath",f(this));n.node.appendChild(e.node);!n.node.id&&c(n.node,{id:n.id})}c(this.node,{"clip-path":h(n.node.id||n.id)})}});eve.on("snap.util.attr.fill",m("fill"));eve.on("snap.util.attr.stroke",m("stroke"));var g=/^([lr])(?:\(([^)]*)\))?(.*)$/i;eve.on("snap.util.grad.parse",function(t){t=p(t);var n=t.match(g);if(!n)return null;var r=n[1],i=n[2],s=n[3];i=i.split(/\s*,\s*/).map(function(e){return+e==e?+e:e});i.length==1&&i[0]==0&&(i=[]);s=s.split("-");s=s.map(function(e){e=e.split(":");var t={color:e[0]};e[1]&&(t.offset=parseFloat(e[1]));return t});return{type:r,params:i,stops:s}});eve.on("snap.util.attr.d",function(t){eve.stop();a(t,"array")&&a(t[0],"array")&&(t=e.path.toString.call(t));t=p(t);t.match(/[ruo]/i)&&(t=e.path.toAbsolute(t));c(this.node,{d:t})})(-1);eve.on("snap.util.attr.#text",function(e){eve.stop();e=p(e);var t=r.doc.createTextNode(e);while(this.node.firstChild)this.node.removeChild(this.node.firstChild);this.node.appendChild(t)})(-1);eve.on("snap.util.attr.path",function(e){eve.stop();this.attr({d:e})})(-1);eve.on("snap.util.attr.class",function(e){eve.stop();this.node.className.baseVal=e})(-1);eve.on("snap.util.attr.viewBox",function(e){var t;a(e,"object")&&"x"in e?t=[e.x,e.y,e.width,e.height].join(" "):a(e,"array")?t=e.join(" "):t=e;c(this.node,{viewBox:t});eve.stop()})(-1);eve.on("snap.util.attr.transform",function(e){this.transform(e);eve.stop()})(-1);eve.on("snap.util.attr.r",function(e){if(this.type=="rect"){eve.stop();c(this.node,{rx:e,ry:e})}})(-1);eve.on("snap.util.attr.textpath",function(e){eve.stop();if(this.type=="text"){var n,r,i;if(!e&&this.textPath){r=this.textPath;while(r.node.firstChild)this.node.appendChild(r.node.firstChild);r.remove();delete this.textPath;return}if(a(e,"string")){var s=f(this),o=u(s.parentNode).path(e);s.appendChild(o.node);n=o.id;o.attr({id:n})}else{e=u(e);if(e instanceof t){n=e.attr("id");if(!n){n=e.id;e.attr({id:n})}}}if(n){r=this.textPath;i=this.node;if(r)r.attr({"xlink:href":"#"+n});else{r=c("textPath",{"xlink:href":"#"+n});while(i.firstChild)r.appendChild(i.firstChild);i.appendChild(r);this.textPath=u(r)}}}})(-1);eve.on("snap.util.attr.text",function(e){if(this.type=="text"){var t=0,n=this.node,i=function(e){var t=c("tspan");if(a(e,"array"))for(var n=0;n<e.length;n++)t.appendChild(i(e[n]));else t.appendChild(r.doc.createTextNode(e));t.normalize&&t.normalize();return t};while(n.firstChild)n.removeChild(n.firstChild);var s=i(e);while(s.firstChild)n.appendChild(s.firstChild)}eve.stop()})(-1);eve.on("snap.util.attr.fontSize",y)(-1);eve.on("snap.util.attr.font-size",y)(-1);eve.on("snap.util.getattr.transform",function(){eve.stop();return this.transform()})(-1);eve.on("snap.util.getattr.textpath",function(){eve.stop();return this.textPath})(-1);(function(){function t(t){return function(){eve.stop();var n=r.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+t);return n=="none"?n:e(r.doc.getElementById(n.match(l)[1]))}}function n(e){return function(t){eve.stop();var n="marker"+e.charAt(0).toUpperCase()+e.substring(1);if(t==""||!t){this.node.style[n]="none";return}if(t.type=="marker"){var r=t.node.id;r||c(t.node,{id:t.id});this.node.style[n]=h(r);return}}}eve.on("snap.util.getattr.marker-end",t("end"))(-1);eve.on("snap.util.getattr.markerEnd",t("end"))(-1);eve.on("snap.util.getattr.marker-start",t("start"))(-1);eve.on("snap.util.getattr.markerStart",t("start"))(-1);eve.on("snap.util.getattr.marker-mid",t("mid"))(-1);eve.on("snap.util.getattr.markerMid",t("mid"))(-1);eve.on("snap.util.attr.marker-end",n("end"))(-1);eve.on("snap.util.attr.markerEnd",n("end"))(-1);eve.on("snap.util.attr.marker-start",n("start"))(-1);eve.on("snap.util.attr.markerStart",n("start"))(-1);eve.on("snap.util.attr.marker-mid",n("mid"))(-1);eve.on("snap.util.attr.markerMid",n("mid"))(-1)})();eve.on("snap.util.getattr.r",function(){if(this.type=="rect"&&c(this.node,"rx")==c(this.node,"ry")){eve.stop();return c(this.node,"rx")}})(-1);eve.on("snap.util.getattr.text",function(){if(this.type=="text"||this.type=="tspan"){eve.stop();var e=b(this.node);return e.length==1?e[0]:e}})(-1);eve.on("snap.util.getattr.#text",function(){return this.node.textContent})(-1);eve.on("snap.util.getattr.viewBox",function(){eve.stop();var t=c(this.node,"viewBox");if(t){t=t.split(d);return e._.box(+t[0],+t[1],+t[2],+t[3])}return})(-1);eve.on("snap.util.getattr.points",function(){var e=c(this.node,"points");eve.stop();if(e)return e.split(d);return})(-1);eve.on("snap.util.getattr.path",function(){var e=c(this.node,"d");eve.stop();return e})(-1);eve.on("snap.util.getattr.class",function(){return this.node.className.baseVal})(-1);eve.on("snap.util.getattr.fontSize",w)(-1);eve.on("snap.util.getattr.font-size",w)(-1)});