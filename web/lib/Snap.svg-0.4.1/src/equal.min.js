// Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
// 
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
// 
// http://www.apache.org/licenses/LICENSE-2.0
// 
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
Snap.plugin(function(e,t,n,r){function u(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return e.length==4?[t,0,e[2],e[3]]:[t,0];case"s":return e.length==5?[t,1,1,e[3],e[4]]:e.length==3?[t,1,1]:[t,1]}}function a(t,n,r){n=o(n).replace(/\.{3}|\u2026/g,t);t=e.parseTransformString(t)||[];n=e.parseTransformString(n)||[];var i=Math.max(t.length,n.length),s=[],a=[],f=0,l,c,h,v;for(;f<i;f++){h=t[f]||u(n[f]);v=n[f]||u(h);if(h[0]!=v[0]||h[0].toLowerCase()=="r"&&(h[2]!=v[2]||h[3]!=v[3])||h[0].toLowerCase()=="s"&&(h[3]!=v[3]||h[4]!=v[4])){t=e._.transform2matrix(t,r());n=e._.transform2matrix(n,r());s=[["m",t.a,t.b,t.c,t.d,t.e,t.f]];a=[["m",n.a,n.b,n.c,n.d,n.e,n.f]];break}s[f]=[];a[f]=[];for(l=0,c=Math.max(h.length,v.length);l<c;l++){l in h&&(s[f][l]=h[l]);l in v&&(a[f][l]=v[l])}}return{from:d(s),to:d(a),f:p(s)}}function f(e){return e}function l(e){return function(t){return+t.toFixed(3)+e}}function c(e){return e.join(" ")}function h(t){return e.rgb(t[0],t[1],t[2])}function p(e){var t=0,n,r,i,s,o,u,a=[];for(n=0,r=e.length;n<r;n++){o="[";u=['"'+e[n][0]+'"'];for(i=1,s=e[n].length;i<s;i++)u[i]="val["+t++ +"]";o+=u+"]";a[n]=o}return Function("val","return Snap.path.toString.call(["+a+"])")}function d(e){var t=[];for(var n=0,r=e.length;n<r;n++)for(var i=1,s=e[n].length;i<s;i++)t.push(e[n][i]);return t}function v(e){return isFinite(parseFloat(e))}function m(t,n){return!e.is(t,"array")||!e.is(n,"array")?!1:t.toString()==n.toString()}var i={},s=/[a-z]+$/i,o=String;i.stroke=i.fill="colour";t.prototype.equal=function(e,t){return eve("snap.util.equal",this,e,t).firstDefined()};eve.on("snap.util.equal",function(t,n){var r,u,g=o(this.attr(t)||""),y=this;if(v(g)&&v(n))return{from:parseFloat(g),to:parseFloat(n),f:f};if(i[t]=="colour"){r=e.color(g);u=e.color(n);return{from:[r.r,r.g,r.b,r.opacity],to:[u.r,u.g,u.b,u.opacity],f:h}}if(t=="viewBox"){r=this.attr(t).vb.split(" ").map(Number);u=n.split(" ").map(Number);return{from:r,to:u,f:c}}if(t=="transform"||t=="gradientTransform"||t=="patternTransform"){n instanceof e.Matrix&&(n=n.toTransformString());e._.rgTransform.test(n)||(n=e._.svgTransform2string(n));return a(g,n,function(){return y.getBBox(1)})}if(t=="d"||t=="path"){r=e.path.toCubic(g,n);return{from:d(r[0]),to:d(r[1]),f:p(r[0])}}if(t=="points"){r=o(g).split(e._.separator);u=o(n).split(e._.separator);return{from:r,to:u,f:function(e){return e}}}var b=g.match(s),w=o(n).match(s);return b&&m(b,w)?{from:parseFloat(g),to:parseFloat(n),f:l(b)}:{from:this.asPX(t),to:this.asPX(t,n),f:f}})});